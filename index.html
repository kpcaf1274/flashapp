<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</title>
    <style>
        #cardContainer {
            display: none;
            border: 1px solid black;
            padding: 10px;
            text-align: left;
            cursor: pointer;
            user-select: none;
            width: 300px;
            margin: auto;
            font-size: 20px;
            background-color: white;
        }
        #sectionSelectContainer {
            display: none;
            text-align: center;
            margin: 20px;
        }
        .small-text {
            font-size: 12px;
            color: gray;
            text-align: center;
        }
        .info-container {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: gray;
        }
        .button-container {
            display: flex;
            bottom: 0; /* ç”»é¢ã®æœ€ä¸‹éƒ¨ã«é…ç½® */
            justify-content: space-between; /* ãƒœã‚¿ãƒ³ã‚’å·¦å³ã«å¯„ã›ã‚‹ */
            align-items: center; /* ãƒœã‚¿ãƒ³ã‚’å‚ç›´æ–¹å‘ã«ä¸­å¤®æƒãˆ */
            margin-top: auto;
            padding: 0 20px; /* å·¦å³ã«ä½™ç™½ã‚’è¿½åŠ  */
        }
        .button-container button {
            padding: 30px 30px; /* ãƒœã‚¿ãƒ³ã®ã‚µã‚¤ã‚ºã‚’å¤§ããã™ã‚‹ */
            font-size: 25px; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å¤§ããã™ã‚‹ */
            cursor: pointer; /* ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒã‚¤ãƒ³ã‚¿ã«å¤‰æ›´ */
        }
        #prevButton {
            margin-right: auto; /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’å·¦å¯„ã› */
        }
        #nextButton {
            margin-left: auto; /* æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚’å³å¯„ã› */
        }
        #flipButton {
            margin: 0 10px; /* Flipãƒœã‚¿ãƒ³ã®å·¦å³ã«ä½™ç™½ã‚’è¿½åŠ  */
        }
    </style>
</head>
<body>
    <input type="file" id="csvFileInput" accept=".csv">
    <div id="sectionSelectContainer">
        <label for="sectionSelect">select sectionï¼š</label>
        <select id="sectionSelect"></select>
        <button id="startButton">start</button>
    </div>
    <div class="info-container">
        <span id="cardNumber"></span>
        <span id="cardSection"></span>
        <span id="cardProgress"></span>
        <span id="defaultLanguage">default:head</span>
        <span id="switch">ğŸ”Š:on</span>
    </div>
    <div id="cardContainer" style="margin-top: 30px;">
        <p id="cardText"></p>
    </div>

    <div style="text-align: right; margin-top: 10px;">
        <button id="audioButton" style="display: none;">ğŸ”Š play audio</button>
    </div>
    <div style="text-align: center; margin-top: 10px;">
        <button id="audioswitch" style="display: none;">audio-auto on/off</button>
        <button id="toggleLanguageButton" style="display: none;">change defalut</button>
        <button id="backToSectionButton" style="display: none;">back to selection of section</button>
        <button id="saveCsvButton" style="display: none;">save CSV</button>
        <div id="memoContainer" style="display: none; margin-top: 10px; font-size: 12px; color: gray;" contenteditable="true"></div>
        <button id="learnedButton" style="display: none;">è¦šãˆãŸ</button> <!-- è¦šãˆãŸãƒœã‚¿ãƒ³ -->
        <button id="restoreButton" style="display: none;">å¾©å…ƒ</button> <!-- å¾©å…ƒãƒœã‚¿ãƒ³ -->
    </div>
    <div class="button-container">
        <button id="prevButton" style="display: none;">Back</button>
        <button id="flipButton" style="display: none;">Flip</button>
        <button id="nextButton" style="display: none;">Next</button>
    </div>


    
    <script>
        let flashcards = [];
        let filteredFlashcards = [];
        let currentIndex = 0;
        let defaultJapanese = true;
        let showingJapanese = true;
        let autoaudio = true;
        let learnedCards = new Set(); // è¦šãˆãŸã‚«ãƒ¼ãƒ‰ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä¿å­˜ã™ã‚‹ã‚»ãƒƒãƒˆ

        document.getElementById('csvFileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const csvText = e.target.result;
                flashcards = parseCSV(csvText);
                populateSectionDropdown();
            };
            reader.readAsText(file);
        });

        function parseCSV(text) {
            const lines = text.split('\n');
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const cols = lines[i].split(',');
                if (cols.length < 5) continue;
                data.push({
                    number: cols[0],
                    section: cols[1],
                    japanese: cols[2],
                    english: cols[3],
                    audio: cols[4].trim(),
                    memo: cols[5] || ''
                });
            }
            return data;
        }

        function populateSectionDropdown() {
            const sectionSet = new Set(flashcards.map(card => card.section));
            const sectionSelect = document.getElementById('sectionSelect');
            sectionSelect.innerHTML = '';
            sectionSet.forEach(section => {
                const option = document.createElement('option');
                option.value = section;
                option.textContent = section;
                sectionSelect.appendChild(option);
            });
            document.getElementById('sectionSelectContainer').style.display = 'block';
        }

function showFlashcard(index) {
    if (index < 0 || index >= filteredFlashcards.length || learnedCards.has(index)) {
        // è¡¨ç¤ºã§ããªã„å ´åˆã¯æ¬¡ã®ã‚«ãƒ¼ãƒ‰ã‚’æ¢ã™
        moveToNextCard();
        return;
    }

    const card = filteredFlashcards[index];
    showingJapanese = defaultJapanese;
    document.getElementById('cardText').innerText = showingJapanese ? card.japanese : card.english;
    document.getElementById('cardNumber').innerText = `No: ${card.number}`;
    document.getElementById('cardSection').innerText = `ã‚»ã‚¯ã‚·ãƒ§ãƒ³: ${card.section}`;
    document.getElementById('cardProgress').innerText = `${index + 1} / ${filteredFlashcards.length}`;

    // ãƒ¡ãƒ¢ã‚’è¡¨ç¤º
    const memoContainer = document.getElementById('memoContainer');
    if (card.memo) {
        memoContainer.innerText = `${card.memo}`;
        memoContainer.style.display = 'block';
    } else {
        memoContainer.innerText = '';
        memoContainer.style.display = 'block';
    }

    // éŸ³å£°ã‚’å†ç”Ÿ
    autoaudioplay();
}

        document.addEventListener("keydown", function (event) {
    // å·¦ã‚­ãƒ¼ï¼ˆArrowLeftï¼‰ãŒæŠ¼ã•ã‚ŒãŸã¨ã
    if (event.key === "ArrowLeft") {
        prev(); // ã€Œæˆ»ã‚‹ã€ã®å‡¦ç†ã‚’å®Ÿè¡Œ
    }
    // å³ã‚­ãƒ¼ï¼ˆArrowRightï¼‰ãŒæŠ¼ã•ã‚ŒãŸã¨ã
    else if (event.key === "ArrowRight") {
        next(); // ã€Œæ¬¡ã¸ã€ã®å‡¦ç†ã‚’å®Ÿè¡Œ
    }
    // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ï¼ˆEnterï¼‰ãŒæŠ¼ã•ã‚ŒãŸã¨ã
    else if (event.key === "Enter") {
        audioplay(); // ã€ŒFlipã€ã®å‡¦ç†ã‚’å®Ÿè¡Œ
    }
    else if (event.key === "ArrowUp") {
        flip(); // ã€ŒFlipã€ã®å‡¦ç†ã‚’å®Ÿè¡Œ        
    }
    else if (event.key === "ArrowDown") {
        flip(); // ã€ŒFlipã€ã®å‡¦ç†ã‚’å®Ÿè¡Œ
    }
});



        document.getElementById('cardContainer').addEventListener('click', flip);
        document.getElementById('flipButton').addEventListener('click', flip);
        document.getElementById('startButton').addEventListener('click', function() {
            const selectedSection = document.getElementById('sectionSelect').value;
            filteredFlashcards = flashcards.filter(card => card.section === selectedSection);
            if (filteredFlashcards.length > 0) {
                document.getElementById('sectionSelectContainer').style.display = 'none';
                document.getElementById('cardContainer').style.display = 'block';
                document.getElementById('nextButton').style.display = 'block';
                document.getElementById('flipButton').style.display = 'block';
                document.getElementById('prevButton').style.display = 'block';
                document.getElementById('audioButton').style.display = 'block';
                document.getElementById('backToSectionButton').style.display = 'block';
                document.getElementById('toggleLanguageButton').style.display = 'block';
                document.getElementById('audioswitch').style.display = 'block';
                document.getElementById('learnedButton').style.display = 'block'; // è¦šãˆãŸãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                document.getElementById('restoreButton').style.display = 'block'; // å¾©å…ƒãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                showFlashcard(0);
            }
        });
 // æ¬¡ã¸ãƒœã‚¿ãƒ³ã®å‡¦ç†ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ç§»å‹•æ©Ÿèƒ½è¿½åŠ ï¼‰
document.getElementById('nextButton').addEventListener('click', next);
// æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®å‡¦ç†ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ç§»å‹•æ©Ÿèƒ½è¿½åŠ ï¼‰
document.getElementById('prevButton').addEventListener('click', prev);

function flip(){
            if (filteredFlashcards.length === 0) return;
            showingJapanese = !showingJapanese;
            const card = filteredFlashcards[currentIndex];
            document.getElementById('cardText').innerText = showingJapanese ? card.japanese : card.english;
            autoaudioplay();
}
function next(){
    if (currentIndex < filteredFlashcards.length - 1) {
        // ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã§æ¬¡ã®ã‚«ãƒ¼ãƒ‰ã«ç§»å‹•
        currentIndex++;
        showFlashcard(currentIndex);
    } else {
        // ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æœ€å¾Œã®ã‚«ãƒ¼ãƒ‰ã«é”ã—ãŸå ´åˆ
        const currentSection = filteredFlashcards[currentIndex].section;
        const nextSection = getNextSection(currentSection);
        if (nextSection) {
            // æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç§»å‹•
            moveToSection(nextSection);
        } else {
            // æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„ï¼ˆã¾ãŸã¯æœ€åˆã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«æˆ»ã‚‹ï¼‰
        }
    }
            autoaudioplay();
}


function prev() {
    if (currentIndex > 0) {
        // ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å‰ã®ã‚«ãƒ¼ãƒ‰ã«ç§»å‹•
        currentIndex--;
        showFlashcard(currentIndex);
    } else {
        // ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æœ€åˆã®ã‚«ãƒ¼ãƒ‰ã«é”ã—ãŸå ´åˆ
        const currentSection = filteredFlashcards[currentIndex].section;
        const prevSection = getPreviousSection(currentSection);
        if (prevSection) {
            // å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç§»å‹•ã—ã€æœ€å¾Œã®ã‚«ãƒ¼ãƒ‰ã«ç§»å‹•
            moveToSection(prevSection, true);
        } else {
            // å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„ï¼ˆã¾ãŸã¯æœ€åˆã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«æˆ»ã‚‹ï¼‰
        }
    }
    autoaudioplay();
}

// æŒ‡å®šã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç§»å‹•ã™ã‚‹é–¢æ•°
// isPrevSection: å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æœ€å¾Œã«ç§»å‹•ã™ã‚‹ã‹ã©ã†ã‹
function moveToSection(section, isPrevSection = false) {
    filteredFlashcards = flashcards.filter(card => card.section === section);
    if (isPrevSection) {
        // å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æœ€å¾Œã®ã‚«ãƒ¼ãƒ‰ã«ç§»å‹•
        currentIndex = filteredFlashcards.length - 1;
    } else {
        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æœ€åˆã®ã‚«ãƒ¼ãƒ‰ã«ç§»å‹•
        currentIndex = 0;
    }
    showFlashcard(currentIndex);
    document.getElementById('sectionSelect').value = section; // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’æ›´æ–°
}
// æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—ã™ã‚‹é–¢æ•°
function getNextSection(currentSection) {
    const sections = Array.from(new Set(flashcards.map(card => card.section)));
    const currentIndex = sections.indexOf(currentSection);
    if (currentIndex < sections.length - 1) {
        return sections[currentIndex + 1];
    }
    return null; // æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒãªã„å ´åˆ
}

// å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—ã™ã‚‹é–¢æ•°
function getPreviousSection(currentSection) {
    const sections = Array.from(new Set(flashcards.map(card => card.section)));
    const currentIndex = sections.indexOf(currentSection);
    if (currentIndex > 0) {
        return sections[currentIndex - 1];
    }
    return null; // å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒãªã„å ´åˆ
}


 
function audioplay() {
            const card = filteredFlashcards[currentIndex];
            if (card.audio) {
                const audio = new Audio(card.audio);
                audio.play();
        } 
        };
function autoaudioplay() {
    if (autoaudio && !showingJapanese) {
        audioplay();
    }
}

        // éŸ³å£°å†ç”Ÿãƒœã‚¿ãƒ³ã®å‡¦ç†
        document.getElementById('audioButton').addEventListener('click', audioplay);

// ã‚»ã‚¯ã‚·ãƒ§ãƒ³é¸æŠã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®å‡¦ç†
        document.getElementById('backToSectionButton').addEventListener('click', function() {
        document.getElementById('sectionSelectContainer').style.display = 'block';
        document.getElementById('cardContainer').style.display = 'none';
        document.getElementById('nextButton').style.display = 'none';
        document.getElementById('flipButton').style.display = 'none';
        document.getElementById('prevButton').style.display = 'none';
        document.getElementById('audioButton').style.display = 'none';
        document.getElementById('backToSectionButton').style.display = 'none';
        document.getElementById('toggleLanguageButton').style.display = 'none';
        document.getElementById('audioswitch').style.display = 'none';
    });
    // éŸ³å£°åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®å‡¦ç†
    document.getElementById('audioswitch').addEventListener('click', function() {
        autoaudio = !autoaudio;
        document.getElementById('switch').innerText = `ğŸ”Š: ${autoaudio ? 'on' : 'off'}`;
        showFlashcard(currentIndex);
    });



    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨€èªåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®å‡¦ç†
        document.getElementById('toggleLanguageButton').addEventListener('click', function() {
        defaultJapanese = !defaultJapanese;
        showingJapanese = defaultJapanese;
        document.getElementById('defaultLanguage').innerText = `ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ${defaultJapanese ? 'è¡¨' : 'è£'}`;
        showFlashcard(currentIndex);
    });

// ãƒ¡ãƒ¢ç·¨é›†ã®å‡¦ç†
document.getElementById('memoContainer').addEventListener('blur', function() {
    const newMemo = this.innerText.replace('ãƒ¡ãƒ¢: ', ''); // ã€Œãƒ¡ãƒ¢: ã€ã‚’é™¤å»
    filteredFlashcards[currentIndex].memo = newMemo; // ãƒ¡ãƒ¢ã‚’æ›´æ–°
    showFlashcard(currentIndex); // è¡¨ç¤ºã‚’æ›´æ–°
});

// CSVä¿å­˜ã®å‡¦ç†
document.getElementById('saveCsvButton').addEventListener('click', function() {
    const csvContent = convertToCSV(flashcards); // ã™ã¹ã¦ã®ã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'updated_flashcards.csv';
    link.click();
});        

// ãƒ‡ãƒ¼ã‚¿ã‚’CSVå½¢å¼ã«å¤‰æ›ã™ã‚‹é–¢æ•°
function convertToCSV(data) {
    const header = ['number', 'section', 'japanese', 'english', 'audio', 'memo'].join(',');
    const rows = data.map(card => {
        return [
            card.number,
            card.section,
            card.japanese,
            card.english,
            card.audio,
            card.memo || '' // ãƒ¡ãƒ¢ãŒãªã„å ´åˆã¯ç©ºæ–‡å­—
        ].join(',');
    });
    return [header, ...rows].join('\n');
}

// showFlashcardé–¢æ•°ã®ä¿®æ­£
function showFlashcard(index) {
    if (index < 0 || index >= filteredFlashcards.length) return;
    currentIndex = index;
    const card = filteredFlashcards[currentIndex];
    showingJapanese = defaultJapanese;
    document.getElementById('cardText').innerText = showingJapanese ? card.japanese : card.english;
    document.getElementById('cardNumber').innerText = `No: ${card.number}`;
    document.getElementById('cardSection').innerText = `ã‚»ã‚¯ã‚·ãƒ§ãƒ³: ${card.section}`;
    document.getElementById('cardProgress').innerText = `${currentIndex + 1} / ${filteredFlashcards.length}`;
    
    //ã€€éŸ³å£°ã‚’å†ç”Ÿ
        autoaudioplay();

    // ãƒ¡ãƒ¢ã‚’è¡¨ç¤º
    const memoContainer = document.getElementById('memoContainer');
    if (card.memo) {
        memoContainer.innerText = `${card.memo}`;
        memoContainer.style.display = 'block'; // ãƒ¡ãƒ¢ãŒã‚ã‚‹å ´åˆã¯è¡¨ç¤º
    } else {
        memoContainer.innerText = '';
        memoContainer.style.display = 'block'; // ãƒ¡ãƒ¢ãŒãªã„å ´åˆã‚‚ç·¨é›†å¯èƒ½ã«ã™ã‚‹
    }

    // CSVä¿å­˜ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
    document.getElementById('saveCsvButton').style.display = 'block';
}
document.getElementById('learnedButton').addEventListener('click', function() {
    if (filteredFlashcards.length === 0) return;

    // ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¦šãˆãŸã‚«ãƒ¼ãƒ‰ã«è¿½åŠ 
    learnedCards.add(currentIndex);

    // æ¬¡ã®ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
    moveToNextCard();
});

function moveToNextCard() {
    let nextIndex = currentIndex + 1;
    while (nextIndex < filteredFlashcards.length && learnedCards.has(nextIndex)) {
        nextIndex++; // æ¬¡ã®è¡¨ç¤ºå¯èƒ½ãªã‚«ãƒ¼ãƒ‰ã‚’æ¢ã™
    }

    if (nextIndex < filteredFlashcards.length) {
        currentIndex = nextIndex;
        showFlashcard(currentIndex);
    } else {
        // è¡¨ç¤ºå¯èƒ½ãªã‚«ãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€åˆã®ã‚«ãƒ¼ãƒ‰ã«æˆ»ã‚‹
        currentIndex = 0;
        while (currentIndex < filteredFlashcards.length && learnedCards.has(currentIndex)) {
            currentIndex++;
        }
        if (currentIndex < filteredFlashcards.length) {
            showFlashcard(currentIndex);
        } else {
        }
    }
}


        
    </script>
</body>
</html>
